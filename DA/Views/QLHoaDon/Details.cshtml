@model DA.Models.HoaDon
@{
    Layout = "_ChuLayout";
    ViewData["Title"] = $"Hóa đơn #{Model.MaHoaDon}";

    var tenPhong = Model.HopDong?.Phong?.TenPhong ?? "N/A";
    var giaPhong = Model.HopDong?.Phong?.GiaPhong ?? 0;
    var phiKhac = Model.ChiTietHoaDons.FirstOrDefault(ct => ct.DichVu?.TenDichVu?.ToLower().Contains("phí khác") == true)?.ThanhTien ?? 0;
}

<div class="card shadow-sm p-4 rounded-3 mt-4">
    <h3 class="text-center text-primary mb-4 fw-bold text-uppercase">CHI TIẾT HÓA ĐƠN #@Model.MaHoaDon</h3>

    <p><strong>Phòng:</strong> @tenPhong</p>
    <p><strong>Ngày lập:</strong> @Model.NgayLap.ToString("dd/MM/yyyy")</p>
    <p><strong>Trạng thái:</strong> @Model.TrangThaiThanhToan</p>

    <table class="table table-bordered text-center mt-4">
        <thead class="table-light">
            <tr>
                <th>Dịch vụ</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ct in Model.ChiTietHoaDons)
            {
                var donGia = ct.DonGia;
                var soLuong = ct.SoLuong;
                var thanhTien = donGia * soLuong;

                <tr>
                    <td>@ct.DichVu?.TenDichVu</td>
                    <td>@donGia.ToString("N0") đ</td>
                    <td>@soLuong.ToString("N2")</td>
                    <td>@thanhTien.ToString("N0") đ</td>
                </tr>
            }

            <tr>
                <td colspan="3" class="text-end fw-bold">Tiền phòng:</td>
                <td class="fw-bold">@giaPhong.ToString("N0") đ</td>
            </tr>

            @if (phiKhac > 0)
            {
                <tr>
                    <td colspan="3" class="text-end fw-bold">Phí khác:</td>
                    <td class="fw-bold">@phiKhac.ToString("N0") đ</td>
                </tr>
            }

            <tr>
                <td colspan="3" class="text-end fw-bold">Tổng tiền:</td>
                <td class="fw-bold text-danger">@Model.TongTien?.ToString("N0") đ</td>
            </tr>
        </tbody>
    </table>

    <div class="d-flex justify-content-between mt-4">
        <a asp-action="Index" class="btn btn-secondary">← Quay lại</a>
        <a asp-action="DownloadPdf" asp-route-id="@Model.MaHoaDon" class="btn btn-outline-danger">Tải PDF</a>
    </div>
</div>
